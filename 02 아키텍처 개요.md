# 4κ°μ μμ—­ 

1. ν‘ν„/UI  
2. μ‘μ©
3. λ„λ©”μΈ
4. μΈν”„λΌ μ¤νΈλ­μ² 

## ν‘ν„/UI    
μ‚¬μ©μμ **μ”μ²­μ„ ν•΄μ„ν•΄μ„ μ‘μ© μ„λΉ„μ¤μ— μ „λ‹¬**ν•κ³         
μ‘μ© μ„λΉ„μ¤μ **κ²°κ³Όλ¥Ό μ‚¬μ©μκ°€ μ΄ν•΄ν•  μ μλ” ν•μ‹μΌλ΅ λ³€ν™ν•΄μ„ μ‘λ‹µ**ν•λ‹¤.          
   
**μ—¬κΈ°μ„ μ‚¬μ©μλ€? π¤”**   
```
μ›Ή λΈλΌμ°μ €μ΄κ±°λ‚, REST APIλ¥Ό μ΄μ©ν• μ™Έλ¶€ μ‹μ¤ν…μΌ μ μλ‹¤.(λ¨λ°”μΌ, κΈ°νƒ€ λ“±λ“±)   
```
           
μ¦‰, `HTTP μ”μ²­`μ„ **μ‘μ© μμ—­μ΄ ν•„μ”λ΅ ν•λ” ν•μ‹μΌλ΅ λ³€ν™ν•΄μ„ `μ‘μ© μμ—­`μ— μ „λ‹¬**ν•κ³              
**`μ‘μ© μμ—­μ μ‘λ‹µ`μ„ HTTP μ‘λ‹µμΌλ΅ λ³€ν™ν•΄μ„ μ „μ†΅ν•λ‹¤.**(Modelμ€ ν•΄λ‹Ή μ‚¬ν•­μ΄ μ•„λ‹λ‹¤.)             
         
μ‰½κ² λ§ν•λ©΄,       
`@RequestBody`λ¥Ό μ΄μ©ν•΄μ„ `μ‚¬μ©μ`λ΅λ¶€ν„° λ„μ–΄μ¨ κ°’μ„ `HTTP μ”μ²­ λ³Έλ¬Έμ— λ‹΄κΈ΄ κ°’λ“¤μ„ μλ°” κ°μ²΄λ΅ λ³€ν™`ν• ν›„ `Service`μ— λ„κΈ°κ³            
`@ResponseBody`λ¥Ό μ΄μ©ν•΄μ„ `Servic`λ΅λ¶€ν„° λ„μ–΄μ¨ κ°’μ„ `HTTP μ‘λ‹µ λ³Έλ¬Έμ JSON κ°μ²΄λ΅ λ³€ν™`ν• ν›„ μ‘λ‹µν•λ” κ²ƒμ„ λ§ν•λ‹¤.          
μ¦‰, `Controller`κ°€ λ€ν‘μ μΈ μμ‹λΌκ³  λ³΄λ©΄ λλ‹¤. (MVCλΌκ³  μ±…μ—μ„λ” λ‚μ™”λ”λ° λ” μμ„Έν λ§ν•λ©΄)        
         
## μ‘μ©   
μ‚¬μ©μμ—κ² **μ κ³µν•΄μ•Ό ν•  κΈ°λ¥μ„ κµ¬ν„ν•λ‹¤.**       
`μ£Όλ¬Έ λ“±λ΅`, `μ£Όλ¬Έ μ·¨μ†`, `μƒν’ μƒμ„Έ μ΅°ν` λ“±λ“±...      
        
`μ‘μ© μμ—­`μ€ κΈ°λ¥μ„ κµ¬ν„ν•κΈ° μ„ν•΄ **λ„λ©”μΈ μμ—­μ λ„λ©”μΈ λ¨λΈλ“¤μ„ μ΄μ©ν•λ‹¤.**     

```java
public class CancelOrderService {
      
    @Transactional    
    public void cancelOrder(String orderId) {    
        Order order = findOrderById(orderId);     
        if(order == null) throw new OrderNotFoundException(orderId);      
        order.cancel();   
    }
}  
```  
μ‘μ© μ„λΉ„μ¤λ” λ΅μ§μ„ μ§μ ‘ μν–‰ν•κΈ° λ³΄λ‹¤λ”         
**λ„λ©”μΈ λ¨λΈμ— λ΅μ§ μν–‰μ„ μ„μ„ν•λ‹¤.(μ—­ν• κ³Ό μ±…μ„)**              
μ„ μ½”λ“λ„ λ„λ©”μΈμΈ `Order`κ°€ `μ·¨μ† μ²λ¦¬`λ¥Ό ν•κ³  μλ‹¤.    
        
κ°μΈμ μΌλ΅, `μ—­ν• `/`μ±…μ„`/`ν‘λ ¥`μ—μ„ `ν‘λ ¥μ„ ν•λ” κ³µκ°„`μ΄λΌκ³ λ„ μƒκ°€ν•©λ‹λ‹¤.     
   
## λ„λ©”μΈ  
λ„λ©”μΈ μμ—­μ€ **`λ„λ©”μΈ λ¨λΈ`μ„ κµ¬ν„ν•λ” μμ—­**μ΄λ‹¤.(`Order`, `ShippingInfo` λ“±λ“±...)        
κ·Έλ¦¬κ³  **`λ„λ©”μΈ λ¨λΈ`μ€ λ„λ©”μΈμ ν•µμ‹¬ λ΅μ§μ„ κµ¬ν„**ν•λ‹¤.     
     
**μ£Όλ¬Έ λ„λ©”μΈ**     
* λ°°μ†΅μ§€ λ³€κ²½    
* κ²°μ  μ™„λ£        
* μ£Όλ¬Έ μ΄μ•΅ κ³„μ‚°    

## μΈν”„λΌ μ¤νΈλ­μ²
μΈν”„λΌμ¤νΈλ­μ² μμ—­μ€ **κµ¬ν„ κΈ°μ **μ— λ€ν• κ²ƒμ„ λ‹¤λ£¬λ‹¤.     

* `RDBMS` μ—°λ™μ²λ¦¬
* [λ©”μ‹μ§• ν](https://ko.wikipedia.org/wiki/%EB%A9%94%EC%8B%9C%EC%A7%80_%ED%81%90)μ— λ©”μ‹μ§€ μ „μ†΅ν•κ±°λ‚ μμ‹     
* `λ½κ³  DB`, `HBase` λ¥Ό μ‚¬μ©ν•΄μ„ λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™ μ²λ¦¬  
* `SMTP`λ¥Ό μ΄μ©ν• λ©”μΌ λ°μ†΅ κΈ°λ¥ κµ¬ν„      
* `HTTP ν΄λΌμ΄μ–ΈνΈ`λ¥Ό μ΄μ©ν•΄μ„ `REST API`λ¥Ό νΈμ¶     
  
`μΈν”„λΌ μ¤νΈλ­μ² μμ—­`μ€      
**λ…Όλ¦¬μ μΈ κ°λ…μ„ ν‘ν„ν•κΈ° λ³΄λ‹¤λ” `μ‹¤μ  κµ¬ν„`μ„ λ‹¤λ£¬λ‹¤.**         
    
`λ„λ©”μΈ λ΅μ§`, `μ‘μ© μμ—­`, `ν‘ν„ μμ—­`μ€ κµ¬ν„ κΈ°μ μ„ μ‚¬μ©ν• μ½”λ“λ¥Ό μ§μ ‘ λ§λ“¤μ§€λ” μ•λ”λ‹¤.   
λ€μ‹ , **μΈν”„λΌ μ¤νΈλ­μ² μμ—­μ—μ„ μ κ³µν•λ” κΈ°λ¥μ„ μ‚¬μ©ν•΄μ„ ν•„μ”ν• κΈ°λ¥μ„ κ°λ°ν•λ‹¤.**    
     
μμ‹1)        
1. μ‘μ© μμ—­μ΄ DBμ— λ³΄κ΄€λ λ°μ΄ν„°κ°€ ν•„μ”
2. μΈν”„λΌ μ¤νΈλ­μ² μμ—­μ DB λ¨λ“μ„ μ‚¬μ©ν•΄μ„ λ°μ΄ν„°λ¥Ό μ½μ–΄μ¨λ‹¤.   
       
μμ‹2)       
1. SMTP μ—°λ™ λ¨λ“μ„ μ΄μ©ν•΄μ„ λ©”μΌ λ°μ†΅    
      
μ‚¬μ‹¤ μ—¬κΈ°μ„ κ°€μ¥ μ¤‘μ”ν•λ‹¤κ³  μƒκ°ν•λ” μ μ€ **κ΄€μ‹¬μ‚¬ λ¶„λ¦¬**μ΄λ‹¤.      
`λ„λ©”μΈ λ΅μ§`, `μ‘μ© μμ—­`, `ν‘ν„ μμ—­`μ€ **κµ¬ν„ κΈ°μ μ„ μ–΄λ–»κ² μ‚¬μ©ν–λ”μ§€ κ΄€μ‹¬μ΄ μ—†λ‹¤.**         
μ¤λ΅μ§€ `λ°μ΄ν„°`λ§μ„ ν•„μ”λ΅ ν•κ³  **κ·Έ λ°μ΄ν„°λ¥Ό μ κ°€κ³µν•λ” μ—­ν• λ§μ„ ν•λ‹¤.**      
μ¦‰, μμ‹ μ μ—­ν• κ³Ό μ±…μ„ -> `μ½”μ–΄ λ°Έλ¥`λ§μ„ μƒκ°ν•  λΏμ΄λ‹¤.      
      
# κ³„μΈµ κµ¬μ΅° μ•„ν‚¤ν…μ²     
`4 μμ—­`μ„ κµ¬μ„±ν•  λ• λ§μ΄ μ‚¬μ©ν•λ” μ•„ν‚¤ν…μ²κ°€ μ•„λμ™€ κ°™μ€ κµ¬μ΅°μ΄λ‹¤.   
    
[μ‚¬μ§„](#)    
       
`ν‘ν„ μμ—­`κ³Ό `μ‘μ© μμ—­`μ€ `λ„λ©”μΈ μμ—­`μ„ μ‚¬μ©ν•κ³ ,       
`λ„λ©”μΈ μμ—­`μ€ `μΈν”„λΌμ¤νΈλ­μ² μμ—­`μ„ μ‚¬μ©ν•λ―€λ΅ κ³„μΈµ κµ¬μ΅°κ°€ μ λ‹Ήν•΄ λ³΄μΈλ‹¤.          
λ¬Όλ΅ , λ„λ©”μΈ λ³µμ΅λ„μ— λ”°λΌ, μ‘μ©κ³Ό λ„λ©”μΈμ„ λ¶„λ¦¬ν•κΈ°λ„ ν•κ³  ν• κ³„μΈµμΌλ΅ ν•©μΉκΈ°λ„ ν•λ‹¤.         
    
**κ³„μΈµ κµ¬μ΅°λ” νΉμ„±μƒ**      
* **`μƒμ„ κ³„μΈµ`μ—μ„ `ν•μ„ κ³„μΈµ`μΌλ΅μ μμ΅΄λ§ μ΅΄μ¬ν•λ‹¤.**  
* **`ν•μ„ κ³„μΈµ`μ€ `μƒμ„ κ³„μΈµ`μ— μμ΅΄ν•μ§€ μ•λ”λ‹¤.**     
   
```java
@Controller
public class SampleController {
    private final SampleService sampleService; // ν•μ„λ¥Ό μμ΅΄
    
    public SampleController(SampleService sampleService) {
        this.sampleService = sampleService;
    }
    ... // 
}
```
μ°λ¦¬κ°€ ν”ν μ‚¬μ©ν•λ” μ½”λ“λ¥Ό λ‹¤μ‹λ³΄λ©΄    
`μƒμ„ κ³„μΈµμΈ ν‘ν„ μμ—­`μ—μ„ `ν•μ„ κ³„μΈµμΈ μ‘μ© μμ—­`μ„ μμ΅΄ν•κ³  μλ” κ²ƒμ„ μ• μ μλ‹¤.      
   
[μ‚¬μ§„](#)  
         
κ³„μΈµ κµ¬μ΅°λ¥Ό μ—„κ²©ν•κ² μ μ©ν•λ©΄ `μƒμ„ κ³„μΈµ`μ€ λ°”λ΅ μ•„λμ `ν•μ„ κ³„μΈµ`μ—λ§ μμ΅΄ν•΄μ•Όν•λ‹¤.           
ν•μ§€λ§, μ„μ™€ κ°™μ΄ κµ¬ν„μ νΈλ¦¬μƒ **κ³„μΈµ κµ¬μ΅°λ¥Ό μ μ—°ν•κ² μ μ©ν•  μλ„ μλ‹¤.**     
     
μ¦‰, `μ‘μ© κ³„μΈµ`μ€ λ°”λ΅ μ•„λ κ³„μΈµμΈ `λ„λ©”μΈ κ³„μΈµ`μ— μμ΅΄ν•μ§€λ§       
**μ™Έλ¶€ μ‹μ¤ν…κ³Όμ μ—°λ™μ„ μ„ν•΄** λ” μ•„λ κ³„μΈµμΈ `μΈν”„λΌ μ¤νΈλ­μ² κ³„μΈµ`μ— μμ΅΄ν•κΈ°λ„ ν•λ‹¤.          
  
```java
@Service
public class SampleServiceImpl implements SampleService {
  
    private final SampleRepository sampleRepository; // λ„λ©”μΈμ΄ μ•„λ‹ μΈν”„λΌμ¤νΈλ­μ² μμ—­  
                                                     // μƒμ„ κ³„μΈµμ— λ€ν• μμ΅΄μ΄ μ—†λ‹¤.  
                                                     
    public SampleServiceImpl(SampleRepository sampleRepository) {
        this.sampleRepository = sampleRepository;
    }
     
    public void findById(Long id) {  
        // μ—¬κΈ°μ„ λ„λ©”μΈμ„ μ–»μ–΄μ„ μ‚¬μ©ν•λ‹¤.   
        Sample sample = sampleRepository.findById(id).orElseThrow(() ->
                new NoSearchSampleByIdException(id));
    }
    
}
```
       
`μ‘μ© μμ—­`κ³Ό `λ„λ©”μΈ μμ—­`μ€        
`DB`λ‚ `μ™Έλ¶€ μ‹μ¤ν… μ—°λ™`μ„ μ„ν•΄ `μΈν”„λΌ μ¤νΈλ­μ²μ κΈ°λ¥`μ„ μ‚¬μ©ν•λ―€λ΅        
μ„μ™€ κ°™μ€ κµ¬μ΅°λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ **μ§κ΄€μ μΌλ΅ μ΄ν•΄ν•κΈ° μ‰¬μ°λ©° κµ¬ν„ λν• νΈλ¦¬ν•λ‹¤.**       
         
ν•μ§€λ§, μ—¬κΈ°μ„ μ§κ³  λ„μ–΄κ° λ¶€λ¶„μ€             
μμΉ« ν•λ©΄, `μ‘μ© κ³„μΈµ`κ³Ό `λ„λ©”μΈ κ³„μΈµ`μ΄       
**κµ¬ν„ λ°©λ²•μ— λ”°λΌ μƒμ„Έν• κµ¬ν„ κΈ°μ μ„ λ‹¤λ£¨λ” `μΈν”„λΌ μ¤νΈλ­μ²μ— μΆ…μ†`λλ‹¤λ” μ μ΄λ‹¤.**              
     
## μΈν”„λΌ μ¤νΈλ­μ²μ— μΆ…μ†λ μ½”λ“  
μμ‹λ΅ `λ£° μ—”μ§„`μ„ μ μ©μ‹μΌλ³΄κ² λ‹¤.         
λ•λ΅λ”, λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ λ³µμ΅ν•΄μ§€λ©΄ κ°μ²΄ μ§€ν–¥μΌλ΅ λ΅μ§μ„ κµ¬ν„ν•λ” κ²ƒλ³΄λ‹¤         
[λ£° μ—”μ§„](https://javacan.tistory.com/entry/118)μ„ μ‚¬μ©ν•λ” λ°©λ²•λ„ λ€μ•μ΄ λ  μ μλ‹¤. (μ‹¤μ λ΅λ„ μ‚¬μ©ν•λ”μ§€λ” μ λ¨λ¥΄κ² λ„¤μ” γ…γ…;)        
         
> λ£° μ—”μ§„μ„ κΉκ² λ‹¤λ£° ν•„μ”λ” μ—†λ‹¤ μƒκ°ν•©λ‹λ‹¤.       
> λ‹¤λ§, μΆ…μ†λ μ½”λ“λ¥Ό λ³΄μ—¬μ¤€λ‹¤λ” μ£Όμ μ— λ€ν•΄μ„λ§ νμ•…ν•λ©΄ μΆ‹μ„ κ²ƒ κ°™μµλ‹λ‹¤.     

**CalculateDiscountService**
```java
public class CalculateDiscountService {
    private DroolsRuleEngine ruleEngine; // κµ¬ν„ κ°μ²΄λ¥Ό μ§μ ‘ μ‚¬μ©  
    
    public CalculateDiscountService() {
        ruleEngine = new DroolsRuleEngine();
    }
    
    public Money calculateDiscount(List<OrderLine> orderLines, String customerId) {
        Customer customer = findCustomer(customerId);
        
        MutableMoney money = new MutableMoney(0);
        List<?> facts = Arrays.asList(customer, money);
        facts.addAll(orderLines);
        ruleEngine.evaluate("discountCalculation", facts);
        return money.toImmutableMoney();  
    }
    
}
``` 
**DroolsRuleEngine**    
```java
public class DroolsRuleEngine {
    private KieContainer KContainer;
    
    public DroolsRuleEngine() {
        KieService ks = KieServices.Factory.get();
        KContainer = ks.getKieClasspathContainer();
    }
    
    public void evalute(String sessionName, List<?> facts) {
        KieSession KSession = KContainer.newKieSession(sessionName);
        try {
            facts.forEach(x -> KSession.insert(x));
            KSession.fireAllRules();
        } finally {
            KSession.dispose();
        }
    }
    
}
```  
`DroolsRuleEngine`λ” `DroolsRuleEngine`λΌλ” `λ£° μ—”μ§„`μ„ μ‚¬μ©ν•λ” `μΈν”„λΌμ¤νΈλ­μ² μμ—­`μ μ½”λ“λ‹¤.             
`evalute()` λ©”μ„λ“λ¥Ό νΈμ¶ν•λ©΄ **λ³„λ„μ νμΌλ΅ μ‘μ„±ν• κ·μΉ™μ„ μ΄μ©ν•΄μ„ μ—°μ‚°μ„ μν–‰ν•λ” μ½”λ“**λΌκ³ λ§ μƒκ°ν•μ.       
      
**μ„ μ½”λ“λ” 2κ°μ ν° λ¬Έμ λ¥Ό κ°€μ§€κ³  μλ‹¤.**        
1. **`CalculateDiscountService`λ§μ„ ν…μ¤νΈν•κΈ° μ–΄λ µλ‹¤. :**   
   `CalculateDiscountService`λ¥Ό ν…μ¤νΈν•λ ¤λ©΄ `RuleEngine`μ΄ μ™„λ²½ν•κ² λ™μ‘ν•΄μ•Όν•λ‹¤.    
   μ¦‰, **`RuleEngine`μ„ μ„¤μ • νμΌμ„ λ§λ“ ν›„μ—μ•Ό μ •μƒμ μΈ ν…μ¤νΈκ°€ κ°€λ¥ν•λ‹¤**λ” μ μ΄λ‹¤.  
2. **λ³€κ²½μ΄ μ–΄λ µλ‹¤.**    
   ```java
        MutableMoney money = new MutableMoney(0);
        List<?> facts = Arrays.asList(customer, money);
        facts.addAll(orderLines);
        ruleEngine.evaluate("discountCalculation", facts);
   ```
   μ΄ μ½”λ“λ“¤μ€ `Drools`μ— νΉν™”λ μ½”λ“λ΅, **λ³€κ²½μ΄ μμ„ κ²½μ° ν„μ¬ ν΄λμ¤μ—λ„ μν–¥μ΄ κ°„λ‹¤.**     
   μ¦‰, `Drools`μ΄ μ•„λ‹ λ‹¤λ¥Έ μΌ€μ΄μ¤λ¥Ό μ‚¬μ©ν•κ³ μ ν•λ‹¤λ©΄ `CalculateDiscountService`μ μ½”λ“λ„ λ³€κ²½ν•΄μ•Όν•λ‹¤.      
            
μ΄μ²λΌ `CalculateDiscountService`κ°€ κµ¬ν„ κ°μ²΄λ¥Ό μ§μ ‘ μμ΅΄ν•κ³  μμΌλ―€λ΅           
λ‹¤λ¥Έ κµ¬ν„ κΈ°μ μ„ μ‚¬μ©ν•κ³ μ ν•  λ• μ½”λ“μ λ§μ€ λ¶€λ¶„μ„ κ³ μ³μ•Όν•λ‹¤.     
       
μ •λ¦¬ν•μλ©΄, **`μΈν”„λΌ μ¤νΈλ­μ²`μμ—­μ κΈ°μ μ„ μ§μ ‘ μμ΅΄**ν•κ³  μλ”λ‹¤λ©΄     
**`ν…μ¤νΈ μ–΄λ ¤μ›€`κ³Ό `κΈ°λ¥ ν™•μ¥μ μ–΄λ ¤μ›€`μ΄λΌλ” λ¬Έμ κ°€ λ°μƒν•λ‹¤.**   
         
## DIP       
`CalculateDiscountService`λ” **μλ―Έμλ” λ‹¨μΌ κΈ°λ¥μ„ μ κ³µν•λ” `κ³ μμ¤€ λ¨λ“`μ΄λ‹¤.**         
κ·Έλ¦¬κ³  `κ³ μμ¤€ λ¨λ“`μ κΈ°λ¥μ„ κµ¬ν„ν•λ ¤λ©΄ **μ—¬λ¬ ν•μ„ κΈ°λ¥μ΄ ν•„μ”ν•λ‹¤.**       
μμ‹λ¥Ό λ“¤λ©΄, `κ³ κ° μ •λ³΄λ¥Ό κµ¬ν•κΈ°`, `λ£° μ‹¤ν–‰`λΌλ” `2 κ°€μ§€ ν•μ„ κΈ°λ¥`μ΄ ν•„μ”ν•λ‹¤.       
       
**`μ €μμ¤€ λ¨λ“`μ€ ν•μ„ κΈ°λ¥μ„ μ‹¤μ λ΅ κµ¬ν„ν• κ²ƒμ΄λ‹¤.**        
`JPA`λ¥Ό μ΄μ©ν•΄μ„ κ³ κ° μ •λ³΄λ¥Όμ½μ–΄μ¤λ” λ¨λ“κ³Ό     
`Drools`λ΅ λ£°μ„ μ‹¤ν–‰ν•λ” λ¨λ“μ΄ μ €μμ¤€ λ¨λ“μ΄ λλ‹¤.     

`κ³ μμ¤€ λ¨λ“`μ΄ μ λ€λ΅ λ™μ‘ν•λ ¤λ©΄ `μ €μμ¤€ λ¨λ“`μ„ μ‚¬μ©ν•΄μ•Όν•λ‹¤.   
κ·Έλ°λ°, `κ³ μμ¤€ λ¨λ“`λ“¤μ΄ `μ €μμ¤€ λ¨λ“`μ„ μ‚¬μ©ν•λ©΄      
**`ν…μ¤νΈ μ–΄λ ¤μ›€`κ³Ό `κΈ°λ¥ ν™•μ¥μ μ–΄λ ¤μ›€`μ΄λΌλ” λ¬Έμ κ°€ λ°μƒν•λ‹¤.**     
μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄μ„ μ°λ¦¬λ” **μ¶”μƒν™”ν• μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ©΄ λλ‹¤.**    
      
`CalculaterDiscountService` μ…μ¥μ— λ΄¤μ„ λ• `μ–΄λ–»κ² κµ¬ν„`ν–λ”μ§€λ” μ¤‘μ”ν•μ§€ μ•λ‹¤.     
λ‹¨μ§€, `κ³ κ° μ •λ³΄μ™€ κµ¬λ§¤ μ •λ³΄μ— λ£°μ„ μ μ©ν•΄μ„ ν• μΈ κΈμ•΅μ„ κµ¬ν•λ‹¤`λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤.     
   
```java
public interface RuleDiscounter {
    public Money applyRules(Customer customer, List<OrderLine> orderLines);   
}
```
```java
public class CalculateDiscountService {
    private RuleDiscounter ruleDiscounter;
    
    public CalculateDiscountService(RuleDiscounter ruleDiscounter) {
        this.ruleDiscounter = ruleDiscounter;
    }
    
    public Money calculateDiscount(List<OrderLine> orderLines, String customerId) {
        Customer customer = findCustomer(customerId);
        return ruleDiscounter.applyRules(customer, orderLines);
    }
    
}
```  
```java
public class DroolsRuleEngine implements RuleDiscounter {
    private KieContainer KContainer;
    
    public DroolsRuleEngine() {
        KieService ks = KieServices.Factory.get();
        KContainer = ks.getKieClasspathContainer();
    }
    
    public void evalute(String sessionName, List<?> facts) {
        KieSession KSession = KContainer.newKieSession(sessionName);
        try {
            facts.forEach(x -> KSession.insert(x));
            KSession.fireAllRules();
        } finally {
            KSession.dispose();
        }
    }
    
}
```
μ΄ κ°™μ΄ μΈν„°νμ΄μ¤λ¥Ό μ°Έμ΅°λ³€μλ΅ λ‘κ³  κµ¬ν„μ²΄λ¥Ό μƒμ„±μλ΅ λ°›λ”λ‹¤λ©΄          
`CalculaterDiscountService`λ” λ” μ΄μƒ `νΉμ • κµ¬ν„μ²΄`μ— μμ΅΄ν•μ§€ μ•κ² λλ‹¤.   
μ •ν™•ν λ§ν•λ©΄ `μ¶”μƒν™”(νΉμ • μΈν„°νμ΄μ¤)`λ¥Ό μμ΅΄ν•λ” ν•νƒκ°€ λμ—λ‹¤.       
          
`μΈν„°νμ΄μ¤(μ¶”μƒν™”)`λ” κ³ μμ¤€ λ¨λ“μ— μ†ν•λ‹¤.                    
κ·Έλ¦¬κ³  μ΄λ¥Ό `κµ¬ν„ν• κµ¬ν„μ²΄(ν•μ„ κΈ°λ¥)`λ“¤μ€ **μΈν„°νμ΄μ¤λ¥Ό μμ΅΄ν•λ” ν•νƒκ°€ λλ‹¤.**    
(κµ¬ν„μ²΄κ°€ μΈν„°νμ΄μ¤λ¥Ό μμ΅΄ν•λ‹¤λ” κ²ƒμ€ μΈν„°νμ΄μ¤μ— λ§λ” μ¶”μƒ λ©”μ„λ“λ¥Ό μ •μν•κΈ° λ•λ¬Έμ΄λΌκ³  μƒκ°ν•λ©΄ λ©λ‹λ‹¤.)        
        
κ·Έλ ‡κΈ°μ— `κ³ μμ¤€ λ¨λ“`μ—μ„ `μ €μ†μ¤€ λ¨λ“`μ„ μμ΅΄ν•κ³  μλ κΈ°μ΅΄ ν•νƒκ°€ μ•„λ‹,     
`μ €μ†μ¤€ λ¨λ“`μ—μ„ `κ³ μμ¤€ λ¨λ“`μ„ μμ΅΄ν•λ” ν•νƒμΈ `DIP(μμ΅΄ μ—­μ „μ μ›μΉ™)`κ°€ μ„±λ¦½λλ‹¤.
   
```
**DIPμ μ›μΉ™**
* **μ²«μ§Έ :** μƒμ„ λ¨λ“μ€ ν•μ„ λ¨λ“μ— μμ΅΄ν•΄μ„λ” μ•λλ‹¤. μƒμ„ λ¨λ“κ³Ό ν•μ„ λ¨λ“ λ¨λ‘ μ¶”μƒν™”μ— μμ΅΄ν•΄μ•Ό ν•λ‹¤.
* **λ‘μ§Έ :** μ¶”μƒν™”λ” μ„Έλ¶€ μ‚¬ν•­μ— μμ΅΄ν•΄μ„λ” μ•λλ‹¤. μ„Έλ¶€μ‚¬ν•­μ΄ μ¶”μƒν™”μ— μμ΅΄ν•΄μ•Ό ν•λ‹¤.
```
  
`DIP`λ¥Ό μ μ©ν•λ©΄ μ•μ„ μ–ΈκΈ‰λμ—λ   
`ν…μ¤νΈ μ–΄λ ¤μ›€`κ³Ό `κΈ°λ¥ ν™•μ¥μ μ–΄λ ¤μ›€`μ΄λΌλ” 2κ°€μ§€ λ¬Έμ κ°€ ν•΄κ²°λλ‹¤.      
  
**ν™•μ¥μ μ–΄λ ¤μ›€**     
* `κ³ μμ¤€ λ¨λ“`μ€ `μ €μμ¤€ λ¨λ“`μ— μμ΅΄ν•μ§€ μ•κ³  μΈν„°νμ΄μ¤μ— μμ΅΄ν•λ‹¤.     
* `μ €μμ¤€ λ¨λ“`μ€ `κ³ μμ¤€ λ¨λ“`μΈ μΈν„°νμ΄μ¤λ¥Ό μμ΅΄ν•λ‹¤.   

```java
// μμ‹1) μ‚¬μ©ν•  μ €μμ¤€ κ°μ²΄ μƒμ„± λ° μƒμ„±μ λ°©μ‹μΌλ΅ μ£Όμ…
RuleDiscounter ruleDiscounter = new DroolsRuleDiscounter();
CalculateDiscountService disService = new CalculateDiscountService(ruleDiscounter);

// μμ‹2) μ‚¬μ©ν•  μ €μμ¤€ κ°μ²΄ λ³€κ²½ λ° μƒμ„±μ λ°©μ‹μΌλ΅ μ£Όμ…
RuleDiscounter ruleDiscounter = new SimpleRuleDiscounter();
CalculateDiscountService disService = new CalculateDiscountService(ruleDiscounter);
```
μƒμ„±κ³Ό κ΄€λ ¨λ μμ—­μ„ λ”°λ΅ λ¶„λ¦¬ν•μ—¬ μ΄λ¥Ό μ£Όμ…ν•΄μ£Όλ©΄        
`OCP μ›μΉ™`μ„ μ§€ν‚¤λ” μ½”λ“λ¥Ό λ§λ“¤ μ μλ‹¤.          
μ¦‰, μƒμ„±κ³Ό κ΄€λ ¨λ λ¶€λ¶„λ§ μμ •ν•λ©΄ λ‚λ¨Έμ§€λ” μμ •ν•  μΌμ΄ μ—†μ–΄μ§„λ‹¤.     
        
**ν…μ¤νΈ μ–΄λ ¤μ›€**      
* μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ―€λ΅ λ€μ©κ°μ²΄(μµλ… κ°μ²΄, λλ‹¤)λ¥Ό μ‚¬μ©ν•μ—¬ ν…μ¤νΈ κ°€λ¥ν•λ‹¤.     

```java
public class CalculateDiscountServiceTest {
    
    @Test(expected = NoCustomerException.class)
    public void noCustomer_thenExceptionShouldBeThrown() {
        // ν…μ¤νΈ λ©μ μ λ€μ© κ°μ²΄   
        CustomerRepository stubRepo = mock(CUstomerRepository.class);
        when(stubRepo.findById("noCustId")).thenReturn(null);

        RuleDiscounter stubRule = (cust, lines) -> null;
        CalculateDiscountService calDisSvc = new CalculateDiscountService(stubRepo, stubRule);
        calDisSvc.calcualteDiscount(someLines, "noCustId");
    }
}
```
`Mock ν”„λ μ„μ›ν¬`λ¥Ό μ΄μ©ν•΄μ„ λ€μ©κ°μ²΄λ¥Ό μƒμ„±ν–κ³ , λλ‹¤μ‹μ„ μ΄μ©ν•΄μ„ κ°μ²΄λ¥Ό μƒμ„±ν–λ‹¤.          
λ‘ λ€μ© κ°μ²΄λ” ν…μ¤νΈλ¥Ό μν–‰ν•λ”λ° ν•„μ”ν• κΈ°λ¥λ§μ„ μν–‰ν•κ³              
μ΄λ“¤μ„ ν™μ©ν•λ©΄ ν…μ¤νΈν•κΈ° μ–΄λ ¤μ› λ μμ—­λ“¤λ„ ν…μ¤νΈκ°€ κ°€λ¥ν•΄μ§„λ‹¤.      
    
μ΄λ ‡κ² μ‹¤μ  κµ¬ν„ μ—†μ΄λ„ ν…μ¤νΈλ¥Ό ν•  μ μλ” μ΄μ λ” `DIP`λ¥Ό μ μ©ν–κΈ° λ•λ¬Έμ΄λ‹¤.       

### DIP μ£Όμμ‚¬ν•­ 
`DIP`λ¥Ό μλ» μƒκ°ν•λ©΄     
λ‹¨μν μΈν„°νμ΄μ¤μ™€ κµ¬ν„ ν΄λμ¤λ¥Ό λ¶„λ¦¬ν•λ” μ •λ„λ΅ λ°›μ•„λ“¤μΌ μ μλ‹¤.        

`DIP`μ ν•µμ‹¬μ€ **κ³ μμ¤€ λ¨λ“μ΄ μ €μμ¤€ λ¨λ“μ— μμ΅΄ν•μ§€ μ•λ„λ΅ ν•κΈ° μ„ν•¨**μΈλ°      
`DIP`λ¥Ό μ μ©ν• κ²°κ³Ό κµ¬μ΅°λ§ λ³΄κ³  **μ €μμ¤€ λ¨λ“μ—μ„ μΈν„°νμ΄μ¤λ¥Ό μ¶”μ¶ν•λ” κ²½μ°κ°€ μλ‹¤.**         
          
μλ¥Ό λ“¤μ–΄, `ν• μΈ κ³„μ‚° κΈμ•΅`μ κ΄€μ μΌλ΅ μ‘μ„±λ κ³ μμ¤€ λ¨λ“ `RuleDiscounter`μ΄ μ•„λ‹λΌ         
`λ£° μ—”μ§„`μ κ΄€μ μΌλ΅ μ‘μ„±λ μ €μμ¤€ λ¨λ“μ΄μ μΈν„°νμ΄μ¤μΈ `RuleEngine`μ„ μ‚¬μ©ν•κ² λλ‹¤λ©΄?         
`λ£° μ—”μ§„`κ³Ό λ‹¤λ¥Έ `ν• μΈ κ³„μ‚° κΈμ•΅ λ°©λ²•`μ„ μ‚¬μ©ν•κ³ μ ν•λ‹¤λ©΄ λ§μ°¬κ°€μ§€λ΅ μ½”λ“λ¥Ό λ³€κ²½ν•΄μ•Όν•λ‹¤.     
          
μ¦‰, λ‹¨μν μΈν„°νμ΄μ¤λ¥Ό λ§λ“λ” κ²ƒμ΄ `DIP`κ°€ μ•„λ‹λΌ         
λ™μΌν• `κ³ μμ¤€ λ¨λ“`μ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•μ—¬       
**κ³ μμ¤€ λ¨λ“μ΄ μ €μμ¤€ λ¨λ“μ— μμ΅΄ν•μ§€ μ•λ„λ΅ ν•΄μ•Όν•λ‹¤.**    
   
### DIPμ™€ μ•„ν‚¤ν…μ²     
`μΈν”„λΌ μ¤νΈλ­μ² μμ—­`μ€ κµ¬ν„ κΈ°μ μ„ λ‹¤λ£¨λ” `μ €μμ¤€ λ¨λ“`μ΄κ³    
`μ‘μ© μμ—­`κ³Ό `λ„λ©”μΈ μμ—­`μ€ `κ³ μμ¤€ λ¨λ“`μ΄λ‹¤.      
  
[μ‚¬μ§„]()   
  
μΈν”„λΌ μ¤νΈλ­μ² κ³„μΈµμ κ°€μ¥ ν•λ‹¨μ— μ„μΉν•λ” κ±”μΈµ κµ¬μ΅°μ™€ λ‹¬λ¦¬   
μ•„ν‚¤ν…μ²μ— `DIP`λ¥Ό μ μ©ν•λ©΄ μ„μ™€ κ°™μ΄ `μΈν”„λΌμ¤νΈλ­μ² μμ—­`μ— `μ‘μ© μμ—­`κ³Ό `λ„λ©”μΈ μμ—­`μ— μμ΅΄ν•λ” κµ¬μ΅°κ°€λλ‹¤.      
    
`μΈν”„λΌ μ¤νΈλ­μ²`μ— μ„μΉν• ν΄λμ¤κ°€         
`λ„λ©”μΈ`μ΄λ‚ `μ‘μ© μμ—­`μ— μ •μν• μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ” κµ¬μ΅°κ°€ λλ―€λ΅        
`λ„λ©”μΈ`κ³Ό `μ‘μ© μμ—­`μ— λ€ν• μν–¥μ„ μ£Όμ§€ μ•κ±°λ‚ μµμ†ν™”ν•λ©΄μ„ κµ¬ν„ κΈ°μ μ„ λ³€κ²½ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ‹¤.       
  
[μ‚¬μ§„]()  
  
μΈν”„λΌ μ¤νΈλ­μ² μμ—­μ EmailNotifier ν΄λμ¤λ”       
μ‘μ© μμ—­μ Notifier μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›κ³  μλ‹¤.      
μ£Όλ¬Έμ‹ ν†µμ§€ λ°©μ‹μ— SMSλ¥Ό μ¶”κ°€ν•΄μ•Όν•λ‹¤λ” μ”κµ¬μ‚¬ν•­μ΄ λ“¤μ–΄μ™”μ„ κ²½μ°       
μ‘μ© μμ—­μ OrderServiceλ” λ³€κ²½ν•  ν•„μ”κ°€ μ—†λ‹¤.         
μ™λƒν•λ©΄, λ‘ ν†µμ§€ λ°©μ‹μ„ ν•¨κ» μ κ³µν•λ” Notifier κµ¬ν„ ν΄λμ¤λ¥Ό μΈν”„λΌμ¤νΈλ­μ² μμ—­μ— μ¶”κ°€ν•λ©΄ λλ‹¤.       
    
λΉ„μ·ν•κ² `MyBatis` λ€μ‹  `JPA`λ¥Ό κµ¬ν„ κΈ°μ λ΅ μ‚¬μ©ν•κ³  μ‹¶λ‹¤λ©΄      
`JPA`λ¥Ό μ΄μ©ν• `OrderRepository` κµ¬ν„ ν΄λμ¤λ¥Ό μΈν”„λΌμ¤νΈλ­μ² μμ—­μ— μ¶”κ°€ν•λ©΄ λλ‹¤.   
   
# λ„λ©”μΈ μμ—­μ μ£Όμ” κµ¬μ„± μ”μ†  

















