# 도메인   
**도메인**이란, **소프트웨어로 해결하고자 하는 문제 영역** 을 의미한다.       
           
`소프트웨어로 해결하고자 하는 문제 영역`란 단어가 익숙치 않아서 감이 잘 오지는 않을텐데               
이를 이해하기 위해서 간단한 예시로 `온라인 서점`이라는 **소프트웨어를 구현**한다고 가정하자.      
           
`온라인 서점 소프트웨어`는 온라인으로 책을 판매하는 기능을 제공한다.    
그리고 책을 판매하는 과정에서는 `상품조회`, `구매`, `결제`, `배송추적`, 기타 등등.. 필요한 기능들도 제공한다.    
사실, 이러한 기능들은 인터넷 없이도 우리가 어떻게든 제공할 수 있는 기능들이다.    
하지만 좀 더 편리하고 유기적으로 사용하고 제공하기 위해, `소프트웨어`를 통해 구현하고자 했던 것이다  
   
도메인은 **소프트웨어로 해결하고자 하는 문제 영역**이라고 말을 했다.  
그렇다. 이말은 즉슨 `온라인 서점`은 우리가 `소프트웨어`로 만드는 하나의 영역이자 **도메인**인 것을 의미한다.     
      
## 하위 도메인     
    
도메인은 다시 **하위 도메인으로 나눌 수 있다.**      
`온라인 서점`은 `상품조회`, `구매`, `결제`, `배송추적`과 같은 기능들의 집합으로 이루어져있다.      
이러한 사실을 통해 `상품조회`, `구매`, `결제`, `배송추적`은 **`온라인 서점`의 하위 도메인이라는 것을 알 수 있다.**        
   
**도메인의 하위 도메인**
* 회원 
* 혜택 
* 주문
* 결제
* 배송
* 정산
* 카탈로그
* 리뷰
* 기타 등등..
      
**카탈로그 하위 도메인**은, 고객에게 구매할 수 있는 상품 목록을 제공한다.                        
**주문 하위 도메인**은, 고객의 주문을 처리한다.                     
**혜택 하위 도메인**은, 쿠폰이나 특별 할인과 같은 서비스를 제공한다.      
**배송 하위 도메인**은, 고객에게 구매한 상품을 전달하는 일련의 과정을 처리한다.    
        
각각의 하위 도메인은 **서로 연동하여 완전한 기능을 제공**한다.         
     
* **고객이 물건을 구매 :** `주문`, `결제`, `배송`, `혜택` 하위 도메인의 기능이 엮이게 된다.     
        
`특정 도메인`을 위한 소프트웨어라고 해서        
도메인이 제공해야 할 **모든 기능을 구현해야하는 것은 아니다.**       
즉, **비즈니스에 필요한 하위 도메인을 구성하고 그 중에서도 필요한 일부만 구성한다.**         
              
대표적인 예로 `배송`과 `결제`가 있다.               
`온라인 쇼핑몰`이란 소프트웨어는 자체적으로 `배송 시스템`을 구축할 수도 있다.       
하지만, 배보다 배꼽이 더 커질 수 있기에 **외부 시스템을 일부 차용해서 사용하는 것이 좋다.**         
즉, **외부 배송 업체의 시스템을 사용하고 배송추적에 필요한 기능만 일부 연동한다.**            
         
`배송`도메인 과 `결제` 도메인          
* 자체 시스템 구현     
* 외부 업체의 시스템 사용       
                 
도메인마다 **고정된 하위 도메인이 존재하는 것은 아니다.**                
모든 온라인 쇼핑몰이 고객 혜택을 제공하는 것은 아니며            
규모가 크지 않은 소규모 업체는 엑셀과 같은 도구를 이용해서 수작업으로 정산을 처리할 수도 있다.          
**하위 도메인을 어떻게 구성할지 여부는 회사 상황에 따라 달라진다.**      
                 
## 도메인 모델                
도메인 모델은 다양한 정의가 존재하는데,                
기본적으로 **도메인 모델**은 **특정 도메인을 개념적으로 표현하는 것이다.**               
             
이를 이해하기 위해서 `주문` 도메인을 도출해보자           
* 주문 : 
  * 상품 몇 개를 선택 
  * 배송지 입력 
  * 선택한 상품의 가격을 이용해서 총 지불 금액 계산  
  * 결제 수단 선택  
  * 배송 전 : 배송지 주소를 변경/주문 취소 가능
  * 배송 후 : 배송지 주소를 변경 불가능 /주문 취소 불가능   

[사진]()   

위 모델(사진)을 보면, `주문`은 `주문번호`와 `지불할 총 금액`이 있고,    
`배송정보`를 변경할 수 있음을 알 수 있다. 물론, `취소`도 할 수 있다.      
이렇듯 도메인 모델을 사용하면,      
**여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는데 도움이 된다.**     

도메인을 이해하려면 **도메인이 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야한다.**     
이런 면에서 기능과 데이터를 함께 보여주는 객체 모델은 도메인을 모델링 하기에 적합하다.   
객체모델 뿐만 아니라, 상태 다이어그램을 통해 비즈니스 로직과 순서를 알 수 있으며   
이외에도 도메인을 이해할 수만 있다면 다양한 표현방식들을 사용해도 된다.   
  
**도메인 모델**은 기본적으로 **도메인 자체를 이해하기 위한 `개념 모델`** 이다.        
개념 모델을 이용해서 바로 코드를 작성할 수 있는 것은 아니기에          
**구현 기술에 맞는 구현 모델이 따로 필요하다.**         
개념 모델과 구현 모델은 서로 다른 것이지만 구현 모델이 개념 모델을 최대한 따르도록 할 수는 있다.   

### 하위 도메인과 모델 
도메인은 다수의 하위 도메인으로 구성된다.    
각 하위 도멩니이 다루는 영역은 서로 다르기 때문에 같은 용어라도 도메인마다 의미가 달라질 수 있다.   
    
예를 들어,        
**카탈로그 도메인의 상품**이 `상품 가격`, `상세 내용`을 담고 있는 정보를 의미한다.         
**매송 도메인의 상품**은 `고객에게 실제로 배송되는 물리적인 상품`을 의미한다.        

즉 **도메인에 따라 용어의 의미가 결정되므로, 여러 하위 도메인을 하나의 다이어그램에 모델링하면 안된다.**    
카탈로그와 배송을 구분하지 않고 하나의 다이어그램에 함께 표시한다고 가정해보면   
이 경우 다이어그램에 표시한 '상품'은 카탈로그의 상품과 배송의 상품 의미를 함께 제공하기에,   
카탈로그 도메인에서의 상품을 제대로 이해하는데 방해되며     
배송 도메인에서의 상품을 제대로 이해하는데 방해된다.       

모델의 각 구성요소는 **특정 도메인을 한정할 때** 비로소 의미가 완전해지기 때문에,     
**각 하위 도메인마다 별도로 모델을 만들어야한다.**      
이는 카탈로그 하위 도메인 모델과 배송 하위 도메인 모델을 따로 만들어야 한다는 것을 뜻한다.      
 
이 부분에 대해서 아직 이해가 잘 안가는데     
디렉터리를 도메인 별로 만들라는 이야기 같기도 하네요     

## 도메인 모델 패턴   
일반적으로 애플리케이션의 아키텍처는 4개의 계층으로 구성된다.    

1. 표현 
2. 응용 
3. 도메인 
4. 인프라 스트럭처 

|계층|설명|
|----|----|
|**사용자인터페이스** 또는 **표현**|사용자의 요청을 처리하고 사용자에게 정보를 보여준다.<br>여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템도 사용자가 될 수 있다.|
|**응용**|사용자가 요청한 기능을 실행한다<br>업무 로직을 직접 구현하지 않으면 도메인 계층을 조합해서 기능을 실행한다.|
|**도메인**|시스템이 제공할 도메인의 규칙을 구현한다.|   
|**인프라 스트럭쳐**|데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동을 처리한다.|    
  
지금 부터 살펴볼 도메인 모델은 **도메인 모델 패턴**으로     
아키텍처상의 `도메인 계층`을 **객체 지향 기법으로 구현한 패턴**을 볼 것이다.    
   
**도메인 계층**은 **도메인의 핵심 규칙을 구현**한다.    
주문 도메인의 경우 `출고전에 배송지를 변경할 수 있다.`는 규칙과   
`주문 취소는 배송전에만 할 수 있다.`는 규칙을 규현한 코드가 도메인 계층에 위치하게 된다.    
이런 도메인 규칙을 객체지향 기법으로 구현하는 패턴이 도메인 모델 패턴이다.   

```java
public class Order {
    private OrderState state;
    private ShippingInfo shippingInfo;
    
    // 배송 정보를 변경하는 로직, 변경 가능한지도 검증한다.  
    public void changeShippingInfo(ShippingInfo newShippingInfo) {
        if(!state.isShippingChangeable()) {
            throw new IllegalStateException("can't change shipping in" + state);   
        }
        this.shippingInfo = newShippingInfo;
    }
    
    // 
    
    
}
```
     











    




  






    






   
